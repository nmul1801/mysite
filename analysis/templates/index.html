{% extends "base_generic.html" %}
{% load static %}
{% block content %}
  <link rel="stylesheet" href="{% static 'css/indexstyle.css' %}"> 
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Ultra" />
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

  <video id="loading_icon" autoplay loop muted playsinline>
      <source src="{% static 'img/football_spin.mp4' %}" type="video/mp4">
      Your browser does not support the video tag.
  </video>
  {% comment %} <img id="loading_icon" src="{% static 'img/football_loading.gif' %}" alt="Loading..."> {% endcomment %}

  <div id="content">
    <div class="col-md-6 offset-md-3">
      <nav class="d-flex justify-content-between">
        <img src="{% static 'img/fflogo.png' %}">
      </nav>
      <input type="hidden" id="error_code" value={{ error_code }}>
      
      <form name="leagueform" id="leagueform" class="p-3" action="/analysis/analysis/" method="get">
        
        <table class="w-50 m-auto lead" cellspacing="5" cellpadding="5">
          <tr id="err_text_col">
            <td colspan="2">
              <h3 class="text-danger text-center">Invalid Input</h3>
              <p class="mt-2 text-center">There was an error finding your league, double check the info below and resubmit</p>
            </td>
          </tr>
          <tr>
            <td class="text-center">
              <label for="plat">Platform: </label>
            </td>
            <td class="text-nowrap d-flex justify-content-between" colspan="2">
              <div>
                <label for="espn">ESPN</label>
                <input onchange="updateForm()" id="espn" type="radio" name="platform" value="espn" checked>
              </div>
              <div>
                <label class="ms-2" for="sleeper">Sleeper</label>
                <input onchange="updateForm()" id="sleeper" type="radio" name="platform" value="sleeper">
              </div>
            </td> 
          </tr>
            <td class="text-end">
              <label for="id">ID: </label>
            </td>
            <td>
              <input required class="txt_input" id="id" type="text" name="id">
            </td>
            <td>
              <svg onclick="jump_to_section('league_id_instructions')" xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-question-square" viewBox="0 0 16 16">
                <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286m1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94"/>
              </svg>
            </td>
            <tr class="espn-info">
              <td class="text-end"><label for="swid">SWID: </label></td>
              <td><input required class="txt_input" id="swid" type="text" name="swid" colspan="3"></td>
              <td>
                <svg onclick="jump_to_section('swid_s2_instructions')" xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-question-square" viewBox="0 0 16 16">
                  <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                  <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286m1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94"/>
                </svg>
              </td>
            </tr>
            <tr class="espn-info">
              <td class="text-end"><label for="s2">S2: </label></td>
              <td><input required class="txt_input" id="s2" type="text" name="s2" colspan="3"></td>
              <td>
                <svg onclick="jump_to_section('swid_s2_instructions')" xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-question-square" viewBox="0 0 16 16">
                  <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                  <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286m1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94"/>
                </svg>
              </td>
            </tr>
          <tr>
            <td colspan="3"><input class="lead w-100 btn btn-primary" type="submit" value="See Analysis"></td>
          </tr>
        </table>
        <hr>
        <table class="w-50 m-auto" cellspacing="5" cellpadding="5">
          <tr>
            <td colspan="3"><input class="lead w-100 btn btn-secondary" onclick="submitExample()" value="View Example"></td>
          </tr>
        </table>
      </form>
      <br>
      <h1>Instructions</h1>
      <hr>
      <div id="sleeper-instructions">
        <h2 class="mt-4 fw-bold" id="league_id_instructions_sleeper">League ID</h2>
        <h3 class="mt-3">Desktop</h3>
        <p>To get your League ID, log into your Sleeper account, select your preferred league, then copy the id from the URL after 'league'</p>
        <img class="w-100" src="{% static 'img/leagueidsleeper.png' %}">
        <h3 class="mt-3">Mobile</h3>
        <p>On mobile, go to your league in the Sleeper app and navigate to your league. Press the settings icon in the top right corner.</p>
        <div class="d-flex justify-content-center">
          <img class="m-3 w-75" src="{% static 'img/sleepermobilesettings.png' %}">
        </div>
        
        <p>Navigate to the general settings.</p>
        <div class="d-flex justify-content-center">
          <img class="m-3 w-75" src="{% static 'img/generalsettings.png' %}">
        </div>
        <p>Scroll to the bottom and copy your league ID</p>
        <div class="d-flex justify-content-center">
          <img class="m-3 w-75" src="{% static 'img/copyleagueid.png' %}">
        </div>
      </div>
      <div id="espn-instructions">
        <p>I highly recommended using a Desktop computer to find this info. Finding, copying and pasting information from mobile is difficult.</p>
        <h2 class="mt-4 fw-bold" id="league_id_instructions_espn">League ID</h2>
        <p>To get your League ID, log into your ESPN account in Chrome (doesn't necessarily need to be Chrome, but the images below will look different in other browsers). Once logged in, copy the number after "leagueId" in the URL</p>
        <img class="w-100" src="{% static 'img/leagueid.png' %}">

        <h2 class="mt-4 fw-bold" id="swid_s2_instructions">SWID and S2</h2>
        <p>SWID and S2 are both in your browsers cookies. So while still logged in to your ESPN account, right click anywhere on the page, then click "Inspect"</p>
        <div class="d-flex justify-content-center">
          <img class="w-25" src="{% static 'img/inspect.png' %}">
        </div>
        <p>After the menu pops up, select the "Application" tab</p>
        <img class="w-100" src="{% static 'img/application.png' %}">
        <p>If it's not already selected, click the Cookies drop down, then select "https://fantasy.espn.com"
        <div class="d-flex justify-content-center">
          <img class="w-50" src="{% static 'img/cookies.png' %}">  
        </div>
        <p>You should then see a large table with columns "Name" and "Value". Scroll down the list until you find the values corresponding to the names "SWID", and "espn_s2". Or use the search box. Do not include brackets '{}' for the SWID</p>
        <p>SWID: </p>
        <img class="w-100" src="{% static 'img/SWID.png' %}">
        <p>espn_s2: </p>
        <img class="w-100" src="{% static 'img/S2.png' %}">
      </div>
      
      
    </div>
      <footer>
        <p class="text-center text-"><small>&copy; 2024 Nicholas Mulligan. All rights reserved.</small></p>
      </footer>
    </div>
    
  </div>

  <script>
    function showLoading() {
      const loading_icon = document.getElementById("loading_icon");
      const page_content = document.getElementById("content");
      page_content.style.display = 'none';
      loading_icon.style.display = 'block';
      return true;
    }
  
    function hideLoading() {
      const loading_icon = document.getElementById("loading_icon");
      const page_content = document.getElementById("content");
      page_content.style.display = 'block';
      loading_icon.style.display = 'none';
    }

    document.addEventListener("DOMContentLoaded", function () {
      hideLoading();
      updateForm();
    });

    // when user returns presses back, hide loading gif
    window.addEventListener("pageshow", function(event) {
        hideLoading();
    });
  
    function submitExample() {
      var form = document.getElementById("leagueform");
      form.platform.value = "sleeper";
      form.id.value = "988223204793614336";
      showLoading();
      document.getElementById("leagueform").submit();
    }

    function jump_to_section(section_id) {
      var section;
      if (section_id == 'league_id_instructions') {
        if (document.getElementById("leagueform").platform.value == 'espn'){
          section = document.getElementById('league_id_instructions_espn');
        } else {
          section = document.getElementById('league_id_instructions_sleeper');
        }
      } else {
        section = document.getElementById(section_id);  
      }

      section.scrollIntoView({ behavior: "smooth", block: "start"});
      void section.offsetWidth;
    }


    function updateForm() {
      var espn_button = document.getElementById('espn');
      var espn_info_items = document.querySelectorAll('.espn-info');
      var sleeper_instructions = document.getElementById('sleeper-instructions');
      var espn_instructions = document.getElementById('espn-instructions');

      var error_code = document.getElementById('error_code');
      var error_col = document.getElementById('err_text_col');

      if (error_code.value == "1") {
        error_col.style.display = 'table-row';
      } else {
        error_col.style.display = 'none';
      }

      if (espn_button.checked) {
        sleeper_instructions.style.display = 'none'
        espn_instructions.style.display = 'block'
        for (var i = 0; i < espn_info_items.length; i++) {
          espn_info_items[i].style.display = 'table-row';
        }
      } else {
        sleeper_instructions.style.display = 'block'
        espn_instructions.style.display = 'none'
        for (var i = 0; i < espn_info_items.length; i++) {
          espn_info_items[i].style.display = 'none';
        }
      }
    }  
  </script>
{% endblock %}